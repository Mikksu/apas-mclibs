
main:

	GLOBAL DIM IsEMBPressed
	
	DIM myModule, myId
	
	IsEMBPressed = 0
	
	PRINT CONTROL + SERIAL_NUMBER
	
	
	'ECatADInit
	AxisInit


	RUNTASK 10, EMER_TASK

End


'初始化EtherCat总线AD采集模块
SUB ECatADInit()

	'连接ZMIO300――ADDA扩展模块
	SLOT_SCAN(0)
	?RETURN
	?"node num " NODE_COUNT(0)
	NODE_AIO(0,0)=32
	?"node 0 start aio " NODE_AIO(0,0)
	SLOT_START(0)
	?RETURN


	'量程设置到0V-5V
	SDO_WRITE(0,0,$5001,1,6,6)

ENDSUB


'初始化脉冲轴
SUB AxisInit()


	' ALM信号的有效电平
	INVERT_IN(0,OFF)
	INVERT_IN(1,OFF)
	INVERT_IN(2,OFF)
	INVERT_IN(3,OFF)
	INVERT_IN(4,OFF) 
	INVERT_IN(5,OFF) 
	INVERT_IN(6,OFF) 
	INVERT_IN(7,OFF)
	INVERT_IN(8,OFF)
	INVERT_IN(9,OFF)
	INVERT_IN(10,OFF)
	INVERT_IN(11,OFF) 
	
	INVERT_IN(24,OFF)
	INVERT_IN(25,OFF)
	INVERT_IN(26,OFF)
	INVERT_IN(27,OFF)
	INVERT_IN(28,OFF)
	INVERT_IN(29,OFF)
	INVERT_IN(30,OFF)
	INVERT_IN(31,OFF)
	INVERT_IN(32,OFF)
	INVERT_IN(33,OFF)
	INVERT_IN(34,OFF)
	INVERT_IN(35,OFF) 


	'设置轴参数
	BASE(0,1,2,3,4,5,6,7,8,9,10,11)
	FWD_IN=0,1,2,3,4,5,6,7,8,9,10,11				'正限位输入
	DATUM_IN=24,25,26,27,28,29,30,31,32,33,34,35   '零点位置输入
	REV_IN=24,25,26,27,28,29,30,31,32,33,34,35		'负限位输入
	ATYPE=7,7,7,7,7,7,7,7,7,7,7,7					'轴类型
	INVERT_STEP=7,7,7,7,7,7,7,7,7,7,7,7			'脉冲模式
	UNITS=1,1,1,1,1,1,1,1,1,1,1,1
	SRAMP=100,100,100,100,100,100,100,100,100,100,100,100
	SPEED=200000,200000,200000,200000,200000,200000,200000,200000,200000,200000,200000,200000
	CREEP=2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000
	ACCEL=3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000
	DECEL=3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000,3000000
	FASTDEC=5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000


	' 对于伺服电机，调整编码器和规划位置的符号以及分频数
	'ENCODER_RATIO(-1,1,2) AXIS(0)

ENDSUB


'急停开关检测任务
Sub EMER_TASK()
	While True

		If IN(23)=ON Then
			RAPIDSTOP(2)
			IsEMBPressed=1
			DELAY(5)
		ELSE
			IsEMBPressed=0
		End If
	WEND
End Sub
